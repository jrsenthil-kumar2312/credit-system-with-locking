# Credit System - Chasm

Basic implementation of Credit APIs with `Node.js Express` framework using `Sequelize` with `PostgreSQL` database.


## Includes

- **ES6** `import/export` implemented with `type: "module"` in `package.json`
- **Error handling** middlewares implemented
- `Tests` added with `mocha` configuration
- Code-coverage using Node.js' built in functionality `c8`
- `Eslint`
- `winston` logger

## üòä Prerequisite

- Docker installed and running.

- Install `nodemon` globally using below command if not installed already

  ```sh
  npm i -g nodemon
  ```

## üöÄ Getting Started

1. You can download or clone this repo and start the application by running the steps below

```sh
docker-compose build

docker-compose up
```

2. By default, demo user data and demo credit data are added to the db.

## üöÄ Testing the API
1. All the APIs are protected by authorization token (JWT) except for user endpoint
Protected endpoints:
GET /v1/credit/users/:userId/balance
POST /v1/credit/users/:userId/add
POST /v1/credit/users/:userId/deduct
POST /v1/credit/users/:userId/recalculate

Unprotected endpoints:
POST /v1/users/
GET /v1/users/:userId
POST /v1/users/login

Steps to test the application

1. POST /v1/users/ --> To create user and get the authorization token OR 
2. POST /v1/users/login --> To get the authorization token with existing user
   Payload :
   {
     "username": "JohnDoe23"
     "password": "password"
   }
3. Copy the "token" and add it as "Authorization: Bearer <token>".
   Below is the sample curl command:
   curl --location 'http://127.0.0.1:3000/v1/credit/users/1/add' \
    --header 'Content-Type: application/json' \
    --header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJqcnNlbnRoaWxrIiwiaWF0IjoxNzEyNTYxNTExfQ.tZ_viDFxXGfy0mQWuQgeItPXjqR15R1cMXuay8sP9K8' \
    --data '{
        "amount": 25
    }'
    
## üß™ Tests & Coverage

```sh
docker-compose build

docker compose run app npm test 
```
  ```

## ‚ÑπÔ∏è Environment Variables

| Variable | Description              | Default Value |
| -------- | ------------------------ | ------------- |
| DB_PORT       | Database port            | `5432`        |
| DB_NAME       | Database name            | `postgres`    |
| DB_USER       | Database username        | `postgres`    |
| DB_PASS       | Database password        | `postgres`    |
| TOKEN_SECRET  | JWT Token Secret         | `a30ea0f1...` |

Note: TOKEN_SECRET can be generated by using the following command: 

```sh
require('crypto').randomBytes(64).toString('hex')
```


## üìö References

- [Sequelize ORM](https://sequelize.org/v6/)
